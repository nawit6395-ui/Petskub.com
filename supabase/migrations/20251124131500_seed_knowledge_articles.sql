-- Ensure slug uniqueness for upserts when this seed runs before index migrations
DROP INDEX IF EXISTS knowledge_articles_slug_unique_idx;
CREATE UNIQUE INDEX IF NOT EXISTS knowledge_articles_slug_unique_idx
ON public.knowledge_articles (slug);

DO $$
DECLARE
  v_author_id UUID;
BEGIN
  SELECT id INTO v_author_id
  FROM auth.users
  ORDER BY created_at
  LIMIT 1;

  IF v_author_id IS NULL THEN
    RAISE EXCEPTION 'Seed knowledge articles requires at least one user record';
  END IF;

  INSERT INTO public.knowledge_articles (
    slug,
    title,
    meta_title,
    meta_description,
    content,
    category,
    image_url,
    image_alt,
    og_title,
    og_description,
    og_image,
    keywords,
    author_id,
    published
  )
  VALUES
    (
      'dog-bath-giant-home-safety',
      'อาบน้ำหมาตัวใหญ่แบบไม่ทำให้เครียด',
      'อาบน้ำหมาตัวใหญ่แบบไม่ทำให้เครียด',
      'คู่มือทีละขั้นตอนสำหรับการอาบน้ำหมาตัวใหญ่ที่บ้านโดยไม่ทำให้หมาเครียดและบ้านเละ',
      $content$
การเตรียมตัวก่อนอาบน้ำสุนัขพันธุ์ใหญ่เริ่มตั้งแต่การแปรงขนเพื่อเอาฝุ่นและขนที่หลุดออก จากนั้นเตรียมผ้าเช็ดตัว 2 ผืน ตะกร้าขวดแชมพู และพื้นที่กันลื่นที่ปลอดภัย หน้าต่างหรือประตูควรปิดเพื่อกันการวิ่งหนี

ระหว่างอาบน้ำให้เริ่มเปิดน้ำอุ่นก่อนแล้วค่อยนำน้องเข้าไป เบี่ยงสายยางให้ไหลจากคอไปลำตัว คอยชมเชยและให้ขนมชิ้นเล็กเพื่อให้หมาผูกประสบการณ์ดี ใช้นิ้วมือกดเบา ๆ ให้แชมพูกระจายถึงชั้นผิวแต่ระวังบริเวณหูและดวงตา

หลังล้างฟองให้รีดน้ำออกด้วยมือตามแนวขน ใช้ผ้าซับแล้วเป่าไดร์แบบอุ่นอ่อน ๆ แบ่งขนออกเป็นชั้นย่อยจะช่วยให้แห้งเร็ว ท้ายสุดปิดจ็อบด้วยสเปรย์บำรุงขนและรางวัลเม็ดโปรด$content$,
      'การดูแล',
      'https://images.unsplash.com/photo-1507146426996-ef05306b995a?auto=format&fit=crop&w=1200&q=80',
      'เจ้าของกำลังดูแลสุนัขพันธุ์ใหญ่หลังอาบน้ำ',
      'อาบน้ำหมาตัวใหญ่ไม่ให้เครียด',
      'ขั้นตอนอาบน้ำหมาตัวใหญ่ที่ปลอดภัยและสะอาดหมดจด',
      'https://images.unsplash.com/photo-1507146426996-ef05306b995a?auto=format&fit=crop&w=1200&q=80',
      ARRAY['การดูแลสุนัข','อาบน้ำหมา','ทิปเจ้าของหมา']::text[],
      v_author_id,
      true
    ),
    (
      'kitten-first-week-survival-guide',
      'แพ็กเกจเอาตัวรอด 7 วันแรกของลูกแมวไร้แม่',
      'คู่มือลูกแมวแรกเกิดที่ไม่มีแม่',
      'วิธีดูแลลูกแมวแรกเกิดตั้งแต่อุณหภูมิ อาหาร ไปจนถึงการขับถ่ายสำหรับผู้รับเลี้ยงมือใหม่',
      $content$
ลูกแมวแรกเกิดยังควบคุมความร้อนไม่ได้ อุณหภูมิเตียงควรอยู่ที่ 30-32°C ใช้ขวดน้ำอุ่นพันผ้าขนหนูวางไว้ด้านข้างและเว้นพื้นที่ให้ลูกแมวคลานหนีความร้อนเมื่ออุ่นเกินไป การให้นมต้องใช้นมผงสูตรเฉพาะลูกแมว ครั้งละ 5-7 มล. ทุก 2-3 ชั่วโมง พร้อมจับเรอหลังป้อนเสมอ

หลังมื้อให้ใช้สำลีชุบน้ำอุ่นถูบริเวณอวัยวะเพศและทวารเพื่อกระตุ้นการขับถ่าย ใช้ทิชชู่แห้งซับเบา ๆ ป้องกันการระคายเคือง ควรจดบันทึกน้ำหนักและจำนวนครั้งที่ถ่ายเพื่อดูว่าได้รับสารอาหารเพียงพอไหม

เมื่อครบสัปดาห์ สังเกตดวงตาเริ่มเปิดและพลังมากขึ้น สามารถค่อย ๆ ขยายช่วงการให้นมเป็นทุก 3-4 ชั่วโมงและเริ่มแนะนำกลิ่นกระบะทราย เพื่อเตรียมเข้าสู่วัย 3-4 สัปดาห์ที่เริ่มลืมตาเต็มที่$content$,
      'การดูแล',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      'ลูกแมวลายสก็อตกำลังถูกโอบอุ้ม',
      'ดูแลลูกแมวแรกเกิดไม่มีแม่',
      'เคล็ดลับดูแลลูกแมวแรกเกิดโดยไม่มีแม่',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      ARRAY['ลูกแมว','การดูแลแมว','มือใหม่รับเลี้ยง']::text[],
      v_author_id,
      true
    ),
    (
      'canine-health-red-flags',
      '10 สัญญาณสุขภาพน้องหมาที่ต้องพาไปหาหมอทันที',
      'สัญญาณอันตรายเรื่องสุขภาพสุนัข',
      'รวมอาการผิดปกติที่เจ้าของไม่ควรปล่อยผ่าน เช่น เหงือกซีด เดินวน กินน้ำมากผิดปกติ',
      $content$
ไม่ว่าสุนัขจะอายุเท่าไร หากสังเกตว่าเหงือกซีด ดวงตาเหลือง หรือหายใจถี่ผิดปกติ นั่นอาจเป็นสัญญาณของภาวะโลหิตจาง ตับอักเสบ หรือหัวใจล้มเหลว ระดับน้ำที่ดื่มมากกว่า 100 มล./กก./วันร่วมกับปัสสาวะบ่อยอาจเกี่ยวข้องกับโรคไตหรือเบาหวานในสุนัข

การเดินวน กดท้องร้อง หรือพยายามอาเจียนแต่ไม่ออกในสุนัขพันธุ์อกลึกเป็นสัญญาณของภาวะกระเพาะบิดที่ต้องผ่าตัดทันที ส่วนหมาวัยชราที่เริ่มงุนงงตอนกลางคืนอาจกำลังเจอภาวะ Cognitive Dysfunction ซึ่งควรพบสัตวแพทย์เพื่อปรับยาและสิ่งแวดล้อม$content$,
      'สุขภาพ',
      'https://images.unsplash.com/photo-1548199973-03cce0bbc87b?auto=format&fit=crop&w=1200&q=80',
      'สุนัขพันธุ์ชิสสุถูกตรวจสุขภาพโดยสัตวแพทย์',
      'สัญญาณอันตรายของสุขภาพหมา',
      'อาการที่เตือนให้พาสุนัขพบสัตวแพทย์ทันที',
      'https://images.unsplash.com/photo-1548199973-03cce0bbc87b?auto=format&fit=crop&w=1200&q=80',
      ARRAY['สุขภาพสุนัข','สัญญาณอันตราย','โรคหมา']::text[],
      v_author_id,
      true
    ),
    (
      'cat-skin-issues-checklist',
      'เช็คลิสต์โรคผิวหนังแมวที่เจ้าของต้องรู้',
      'โรคผิวหนังแมวที่พบได้บ่อย',
      'จากเชื้อราไปจนถึงภูมิแพ้ไรฝุ่น วิธีสังเกตอาการและแนวทางดูแลเบื้องต้น',
      $content$
แมวที่เกามากจนขนร่วงเป็นหย่อมมักเกี่ยวข้องกับเชื้อราหรือภูมิแพ้ หากเห็นขอบรอยแดงเป็นวงกลมและมีสะเก็ด ควรแยกแมวป่วยออกจากตัวอื่นและพาไปตรวจ หาเวลาซักผ้าห่ม หมอน และทำความสะอาดอุปกรณ์ด้วยน้ำร้อน

ส่วนแมวที่มีรังแคเป็นเม็ดเล็ก ๆ ทั่วหลังมักขาดกรดไขมันหรือโดนเห็บหมัดกัด ควรเติมโอเมก้า-3 ในอาหารและใช้หวีเสี้ยนเพื่อเช็กตัวปรสิต พร้อมทำสเปรย์ดักหมัดรอบบ้าน$content$,
      'สุขภาพ',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      'แมวเปอร์เซียกำลังกวาดลำตัวด้วยลิ้น',
      'โรคผิวหนังในแมวที่ต้องระวัง',
      'แนวทางดูแลโรคผิวหนังแมวและวิธีสังเกตอาการ',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      ARRAY['สุขภาพแมว','ผิวหนังแมว','เชื้อราแมว']::text[],
      v_author_id,
      true
    ),
    (
      'prepare-home-for-rescue-dog',
      'เช็กลิสต์เตรียมบ้านก่อนรับหมาจรเข้าบ้าน',
      'เตรียมบ้านอย่างไรให้พร้อมรับหมาจร',
      'แผน 3 โซนหลัก: พื้นที่พักผ่อน โซนให้อาหาร และมุมปลอดภัยสำหรับหมาจรตัวใหม่',
      $content$
เริ่มจากโซนพักผ่อน ตั้งกรงหรือเตียงที่มองเห็นคนในบ้านแต่ไม่พลุกพล่าน ปูผ้าห่มที่มีกลิ่นบ้านใหม่ให้หมารู้สึกมั่นคง โซนอาหารควรวางห่างจากทางเดินหลักอย่างน้อย 1 เมตรเพื่อกันการถูกขัดจังหวะและป้องกันการ Guard Food

สุดท้ายจัดมุมปลอดภัย เช่น ใต้โต๊ะหรือห้องทำงานที่ปิดประตูได้ เมื่อหมาจรเริ่มกังวลให้พาเข้ามุมนี้พร้อมเปิดดนตรีสม่ำเสมอ และตั้งตารางการพาเดินรอบบ้านวันละ 3 ครั้งเพื่อสร้างความคุ้นเคย$content$,
      'รับเลี้ยง',
      'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80',
      'เจ้าของกำลังกอดสุนัขจรตัวใหม่',
      'เตรียมบ้านรับหมาจรแบบเป็นระบบ',
      'เช็กลิสต์จัดบ้านก่อนรับสุนัขจรเข้ามาอยู่ร่วม',
      'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80',
      ARRAY['รับเลี้ยงหมา','หมาจร','เตรียมบ้าน']::text[],
      v_author_id,
      true
    ),
    (
      'cat-body-language-guide',
      'อ่านใจแมวผ่านภาษากาย: จากหางถึงหนวด',
      'เข้าใจภาษากายแมวภายใน 5 นาที',
      'สัญญาณสำคัญที่บอกว่าแมวกำลังพอใจ หวาดกลัว หรือเตรียมพุ่งจู่โจม',
      $content$
หางที่ยกขึ้นเป็นรูปเครื่องหมายคำถามหมายถึงแมวกำลังทักทายและเชื่อมั่นในเจ้าของ ส่วนหางที่สลัดแรง ๆ ร่วมกับหูแบะบ่งบอกว่ากำลังหงุดหงิด ควรหยุดกอดและปล่อยให้เขาสงบสติ

หนวดที่แผ่ตรงไปข้างหน้าคือโหมดนักล่า ในขณะที่หนวดหุบชิดแก้มคือกำลังหวาดกลัว การสังเกตตำแหน่งตากับหูประกอบกันจะช่วยลดการโดนข่วนโดยไม่ตั้งใจ และช่วยให้เราเติมเต็มกิจกรรมที่แมวต้องการ$content$,
      'พฤติกรรม',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      'แมวส้มกำลังจ้องมองอย่างตั้งใจ',
      'คู่มืออ่านภาษากายแมว',
      'ท่าทางหาง หนวด และหูของแมวหมายถึงอะไร',
      'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=1200&q=80',
      ARRAY['พฤติกรรมแมว','สื่อสารกับแมว','หางแมว']::text[],
      v_author_id,
      true
    )
  ON CONFLICT (slug) DO UPDATE SET
    title = EXCLUDED.title,
    meta_title = EXCLUDED.meta_title,
    meta_description = EXCLUDED.meta_description,
    content = EXCLUDED.content,
    category = EXCLUDED.category,
    image_url = EXCLUDED.image_url,
    image_alt = EXCLUDED.image_alt,
    og_title = EXCLUDED.og_title,
    og_description = EXCLUDED.og_description,
    og_image = EXCLUDED.og_image,
    keywords = EXCLUDED.keywords,
    author_id = EXCLUDED.author_id,
    published = EXCLUDED.published,
    updated_at = timezone('Asia/Bangkok', now());
END $$;
